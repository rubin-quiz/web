<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>SesquiTypedalian</title>
    <style>
        /* ========== Base Layout ========== */
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px 0 130px;
            background: linear-gradient(135deg, #1e3c72, #8290b4);
            color: white;
            overflow: hidden;
        }

        /* ========== Common Containers ========== */
        .start-container,
        .quiz-container,
        .result-container {
            max-width: 850px;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin: 50px auto;
            backdrop-filter: blur(10px);
        }

        .quiz-container,
        .result-container {
            display: none;
        }

        .quiz-container {
            min-height: 700px;
        }

        h1 {
            font-size: 45px;
            font-weight: bold;
            margin: 0 0 30px;
            text-shadow: 5px 5px #023788;
        }

        h3 {
            margin: 0;
        }

        .highlight-title {
            color: white;
            text-shadow: 5px 5px #0066ff;
            font-weight: bold;
        }

        .highlight-typed {
            color: #535353;
            font-weight: bold;
        }

        /* ========== Rule / Settings ========== */
        .rules {
            text-align: left;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .rule-title,
        .settings-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .settings-container {
            text-align: left;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 30px;
            border-radius: 10px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        .settings-grid div {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 5px;
        }

        /* ========== Common Button ========== */
        .btn-main {
            background: #0059ff;
            color: #fff;
            font-weight: bold;
            font-size: 18px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
            border-bottom: 7px solid #004bd6;
        }

        .btn-main:hover {
            background: #33c5ff;
            border-bottom: 5px solid #0099dd;
            transform: translateY(-1px);
        }

        /* ========== Quiz Screen ========== */
        .timer-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .timer-text,
        .score-display {
            font-size: 14px;
            color: #fff;
        }

        .timer-text {
            min-width: 70px;
            text-align: right;
        }

        .score-display {
            min-width: 80px;
            text-align: left;
        }

        .timer-container {
            flex-grow: 1;
            height: 16px;
            background: #ddd;
            border-radius: 8px;
            overflow: hidden;
        }

        .timer-bar {
            height: 100%;
            background-color: #4caf50;
            transition: width 0.1s linear;
            border-radius: 8px 0 0 8px;
        }

        .key-guide {
            font-size: 14px;
            margin-bottom: 15px;
        }

        .question {
            font-size: 26px;
            font-weight: bold;
            margin: 20px 0 30px;
        }

        .options {
            display: grid;
            gap: 15px;
        }

        .option {
            padding: 30px;
            border: 2px solid #0044ff;
            border-radius: 10px;
            background: rgba(0, 80, 252, 0.2);
            cursor: pointer;
            text-align: center;
            transition: 0.3s;
            color: white;
            font-size: 20px;
        }

        .roman {
            display: block;
            font-size: 20px;
            font-weight: bold;
            margin-top: 5px;
        }

        .disabled-option {
            opacity: 0.4;
            pointer-events: none;
            background-color: #555;
        }

        .input-error {
            animation: flash-red 0.1s ease-in-out;
            background-color: rgba(255, 0, 0, 0.2);
        }

        @keyframes flash-red {
            50% {
                background-color: rgba(255, 0, 0, 0.2);
            }
        }

        /* ========== Popup ========== */
        .popup {
            display: none;
            position: fixed;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 30px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            z-index: 999;
        }

        .popup-correct {
            background-color: #28a745;
        }

        .popup-wrong {
            background-color: #dc3545;
        }

        .popup-pass,
        .popup-start {
            background-color: #444;
        }

        /* ========== Result Screen ========== */
        .result-container {
            display: none;
            text-align: center;
            max-width: 720px;
            min-height: 520px;
            margin-top: 60px;
            padding: 48px 36px 36px;
            background: rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(14px);
        }

        .result-badge {
            display: inline-block;
            font-weight: 800;
            letter-spacing: 0.08em;
            font-size: 14px;
            color: #eaf6ff;
            background: linear-gradient(90deg, #0071ff, #35c4ff);
            padding: 6px 12px;
            border-radius: 999px;
            box-shadow: 0 4px 12px rgba(0, 150, 255, 0.35);
        }

        .result-title {
            font-size: 45px;
            font-weight: bold;
            text-shadow: 5px 5px #023788;
            margin: 0 0 30px;
        }

        .result-score {
            margin: 28px auto 32px;
            display: inline-flex;
            align-items: baseline;
            gap: 12px;
            background: rgba(255, 255, 255, 0.15);
            padding: 18px 28px;
            border-radius: 14px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.25);
        }

        .result-score .label {
            font-size: 18px;
            opacity: 0.9;
        }

        .result-score .value {
            font-size: 56px;
            font-weight: 800;
            text-shadow: 0 0 10px #00aaff;
        }

        .btn-x {
            background: #000;
            color: #fff;
            width: 200px;
            border-radius: 10px;
            padding: 10px 18px;
            margin: 0 auto 10px;
            display: block;
            font-weight: bold;
            transition: 0.2s;
        }

        .btn-x:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
        }

        .result-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 16px;
            flex-wrap: wrap;
        }
    </style>
</head>

<body>
    <!-- ===== Start Screen ===== -->
    <div class="start-container" id="start-container">
        <h3>é•·å¤§èªã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ </h3>
        <h1>Sesqui<span class="highlight-title">Type</span>dalian</h1>

        <div class="rules">
            <div class="rule-title">ãƒ«ãƒ¼ãƒ«</div>
            <div>
                ãƒ»æ­£è§£ã ã¨æ€ã†é¸æŠè‚¢ã®èª­ã¿ã‚’ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã—ã¦ãã ã•ã„<br>
                ãƒ»60ç§’é–“ã§ã§ãã‚‹ã ã‘å¤šãã®å•é¡Œã«æ­£è§£ã—ã¦ãã ã•ã„<br>
                ãƒ»å˜èªãŒé•·ã„ã»ã©ã‚‚ã‚‰ãˆã‚‹ãƒã‚¤ãƒ³ãƒˆãŒå¤§ãããªã‚Šã¾ã™<br>
                ãƒ»BackSpaceã§1æ–‡å­—æ¶ˆå»ã€Enterã§å…¨æ¶ˆå»ã€Spaceã§2å›ã¾ã§ãƒ‘ã‚¹ãŒã§ãã¾ã™
            </div>
        </div>

        <div class="settings-container">
            <div class="settings-title">ãƒ­ãƒ¼ãƒå­—å…¥åŠ›è¨­å®š</div>
            <div class="settings-grid">
                <div><span>ã—ã€€</span><label><input type="radio" name="shi" value="shi" checked> shi</label><label><input
                            type="radio" name="shi" value="si"> si</label><label><input type="radio" name="shi"
                            value="ci"> ci</label></div>
                <div><span>ã˜ã€€</span><label><input type="radio" name="ji" value="ji" checked> ji</label><label><input
                            type="radio" name="ji" value="zi"> zi</label></div>
                <div><span>ã¡ã€€</span><label><input type="radio" name="chi" value="chi" checked> chi</label><label><input
                            type="radio" name="chi" value="ti"> ti</label></div>
                <div><span>ã—ã‚ƒ</span><label><input type="radio" name="sha" value="sha" checked> sha</label><label><input
                            type="radio" name="sha" value="sya"> sya</label></div>
                <div><span>ã—ã‚…</span><label><input type="radio" name="shu" value="shu" checked> shu</label><label><input
                            type="radio" name="shu" value="syu"> syu</label></div>
                <div><span>ã—ã‚‡</span><label><input type="radio" name="sho" value="sho" checked> sho</label><label><input
                            type="radio" name="sho" value="syo"> syo</label></div>
                <div><span>ã¤ã€€</span><label><input type="radio" name="tsu" value="tsu" checked> tsu</label><label><input
                            type="radio" name="tsu" value="tu"> tu</label></div>
                <div><span>ã£ã€€</span><label><input type="radio" name="small-tsu" value="double" checked>
                        ç›´å‰ã®å­éŸ³ã‚’é‡è¤‡</label><label><input type="radio" name="small-tsu" value="x"> x +
                        ã¤</label><label><input type="radio" name="small-tsu" value="l"> l + ã¤</label></div>
                <div><span>ã¡ã‚ƒ</span><label><input type="radio" name="cha" value="cha" checked> cha</label><label><input
                            type="radio" name="cha" value="tya"> tya</label></div>
                <div><span>ã¡ã‚…</span><label><input type="radio" name="chu" value="chu" checked> chu</label><label><input
                            type="radio" name="chu" value="tyu"> tyu</label></div>
                <div><span>ã¡ã‚‡</span><label><input type="radio" name="cho" value="cho" checked> cho</label><label><input
                            type="radio" name="cho" value="tyo"> tyo</label></div>
                <div><span>ã¦ãƒ</span><label><input type="radio" name="thi" value="thi" checked> thi</label><label><input
                            type="radio" name="thi" value="tyi"> tyi</label></div>
                <div><span>ãµã€€</span><label><input type="radio" name="fu" value="fu" checked> fu</label><label><input
                            type="radio" name="fu" value="hu"> hu</label></div>
                <div><span>ã‚“ã€€</span><label><input type="radio" name="n" value="auto" checked> è‡ªå‹• (n ã¾ãŸã¯
                        nn)</label><label><input type="radio" name="n" value="nn"> å¸¸ã« nn</label></div>
            </div>
        </div>

        <button class="btn-main" onclick="startGame()">Play Game</button>
    </div>

    <!-- ===== Quiz Screen ===== -->
    <div class="quiz-container" id="quiz-container">
        <div class="timer-row">
            <div id="timer-text" class="timer-text">æ®‹ã‚Šï¼š60s</div>
            <div class="timer-container">
                <div class="timer-bar" id="timer-bar"></div>
            </div>
            <div id="score-display" class="score-display">å¾—ç‚¹ï¼š0</div>
        </div>
        <div class="key-guide" id="key-guide">Spaceï¼šãƒ‘ã‚¹ï¼ˆæ®‹ã‚Š2ï¼‰ã€€Backspaceï¼š1æ–‡å­—å‰Šé™¤ã€€Enterï¼šå…¨å‰Šé™¤</div>
        <div class="question" id="question"></div>
        <div class="options" id="options"></div>
    </div>

    <!-- ===== Result Screen ===== -->
    <div class="result-container" id="result-container">
        <div class="result-badge">Result</div>
        <div class="result-title">Sesqui<span class="highlight-title">Type</span>dalian</div>
        <div class="result-score"><span class="label">Score</span><span class="value" id="final-score">0</span></div>
        <a id="share-x" class="btn-x" target="_blank" rel="noopener noreferrer">çµæœã‚’Xã«æŠ•ç¨¿</a>
        <div class="result-actions">
            <button class="btn-main" onclick="goHome()">ğŸ  Home</button>
            <button class="btn-main" onclick="startGame()">â†º Restart</button>
        </div>
    </div>

    <div class="popup" id="popup"></div>

    <script>
        /* ========== Initialization ========== */
        const questions = [
            {
                question: "Q. æ˜ ç”»ã€ãƒ¡ãƒªãƒ¼ãƒ»ãƒãƒ”ãƒ³ã‚ºã€ã®åŠ‡ä¸­æ­Œã¯ï¼Ÿ",
                options: [
                    "ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒªãƒ•ãƒ©ã‚¸ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ã‚¨ã‚¯ã‚¹ãƒ”ã‚¢ãƒªãƒ‰ãƒ¼ã‚·ãƒ£ã‚¹",
                    "ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¨ã‚¯ã‚¹ãƒ”ã‚¢ãƒªã‚«ãƒªãƒ•ãƒ©ã‚¸ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ãƒ‰ãƒ¼ã‚·ãƒ£ã‚¹",
                    "ãƒã‚¤ãƒ‘ãƒ¼ã‚«ãƒªãƒ•ãƒ©ã‚¸ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ã‚¨ã‚¯ã‚¹ãƒ”ã‚¢ãƒªãƒ‰ãƒ¼ã‚·ãƒ£ã‚¹",
                    "ãƒã‚¤ãƒ‘ãƒ¼ã‚¨ã‚¯ã‚¹ãƒ”ã‚¢ãƒªã‚«ãƒªãƒ•ãƒ©ã‚¸ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ãƒ‰ãƒ¼ã‚·ãƒ£ã‚¹",
                ],
                options_kana: [
                    "ã™ãƒ¼ã±ãƒ¼ã‹ã‚Šãµã‚‰ã˜ã‚Šã™ã¦ãƒã£ããˆãã™ã´ã‚ã‚Šã©ãƒ¼ã—ã‚ƒã™",
                    "ã™ãƒ¼ã±ãƒ¼ãˆãã™ã´ã‚ã‚Šã‹ã‚Šãµã‚‰ã˜ã‚Šã™ã¦ãƒã£ãã©ãƒ¼ã—ã‚ƒã™",
                    "ã¯ã„ã±ãƒ¼ã‹ã‚Šãµã‚‰ã˜ã‚Šã™ã¦ãƒã£ããˆãã™ã´ã‚ã‚Šã©ãƒ¼ã—ã‚ƒã™",
                    "ã¯ã„ã±ãƒ¼ãˆãã™ã´ã‚ã‚Šã‹ã‚Šãµã‚‰ã˜ã‚Šã™ã¦ãƒã£ãã©ãƒ¼ã—ã‚ƒã™",
                ],
            },
            {
                question: "Q. ãƒãƒƒã‚¯ã‚¹ãƒ»ãƒ´ã‚§ãƒ¼ãƒãƒ¼ã®è‘—æ›¸ã€Œãƒ—ãƒ­å€«ã€ã¨ã„ãˆã°ï¼Ÿ",
                options: [
                    "ãƒ—ãƒ­ãƒ†ã‚¹ã‚¿ãƒ³ãƒ†ã‚£ã‚ºãƒ ã®å€«ç†ã¨è³‡æœ¬ä¸»ç¾©ã®ç²¾ç¥",
                    "ãƒ—ãƒ­ãƒ†ã‚¹ã‚¿ãƒ³ãƒ†ã‚£ã‚ºãƒ ã®ç²¾ç¥ã¨è³‡æœ¬ä¸»ç¾©ã®å€«ç†",
                    "ãƒ—ãƒ­ãƒ†ã‚¹ã‚¿ãƒ³ãƒ†ã‚£ã‚ºãƒ ã¨è³‡æœ¬ä¸»ç¾©ã®å€«ç†ã¨ç²¾ç¥",
                    "ãƒ—ãƒ­ãƒ†ã‚¹ã‚¿ãƒ³ãƒ†ã‚£ã‚ºãƒ ã¨è³‡æœ¬ä¸»ç¾©ã®ç²¾ç¥ã¨å€«ç†",
                ],
                options_kana: [
                    "ã·ã‚ã¦ã™ãŸã‚“ã¦ãƒãšã‚€ã®ã‚Šã‚“ã‚Šã¨ã—ã»ã‚“ã—ã‚…ãã®ã›ã„ã—ã‚“",
                    "ã·ã‚ã¦ã™ãŸã‚“ã¦ãƒãšã‚€ã®ã›ã„ã—ã‚“ã¨ã—ã»ã‚“ã—ã‚…ãã®ã‚Šã‚“ã‚Š",
                    "ã·ã‚ã¦ã™ãŸã‚“ã¦ãƒãšã‚€ã¨ã—ã»ã‚“ã—ã‚…ãã®ã‚Šã‚“ã‚Šã¨ã›ã„ã—ã‚“",
                    "ã·ã‚ã¦ã™ãŸã‚“ã¦ãƒãšã‚€ã¨ã—ã»ã‚“ã—ã‚…ãã®ã›ã„ã—ã‚“ã¨ã‚Šã‚“ã‚Š",
                ],
            },
            {
                question: "Q. ãƒ•ãƒ©ãƒ³ã‚¹ã®ç”»å®¶ãƒ»ã‚¹ãƒ¼ãƒ©ã®ä»£è¡¨ä½œã¨ã„ãˆã°ï¼Ÿ",
                options: [
                    "ã‚°ãƒ©ãƒ³ãƒ‰ã‚¸ãƒ£ãƒƒãƒˆå³¶ã®æ—¥æ›œæ—¥ã®åˆå¾Œ",
                    "ã‚°ãƒ©ãƒ³ãƒ‰ã‚¸ãƒ£ãƒƒãƒˆå³¶ã®åœŸæ›œæ—¥ã®åˆå¾Œ",
                    "ã‚°ãƒ©ãƒ³ãƒ‰ã‚¸ãƒ£ãƒƒãƒˆå³¶ã®æ—¥æ›œæ—¥ã®åˆå‰",
                    "ã‚°ãƒ©ãƒ³ãƒ‰ã‚¸ãƒ£ãƒƒãƒˆå³¶ã®åœŸæ›œæ—¥ã®åˆå‰",
                ],
                options_kana: [
                    "ãã‚‰ã‚“ã©ã˜ã‚ƒã£ã¨ã¨ã†ã®ã«ã¡ã‚ˆã†ã³ã®ã”ã”",
                    "ãã‚‰ã‚“ã©ã˜ã‚ƒã£ã¨ã¨ã†ã®ã«ã¡ã‚ˆã†ã³ã®ã”ãœã‚“",
                    "ãã‚‰ã‚“ã©ã˜ã‚ƒã£ã¨ã¨ã†ã®ã©ã‚ˆã†ã³ã®ã”ã”",
                    "ãã‚‰ã‚“ã©ã˜ã‚ƒã£ã¨ã¨ã†ã®ã©ã‚ˆã†ã³ã®ã”ãœã‚“",
                ],
            },
            {
                question: "Q. ã‚¤ã‚®ãƒªã‚¹ã®æ­£å¼åç§°ã¯ï¼Ÿ",
                options: [
                    "ã‚°ãƒ¬ãƒ¼ãƒˆãƒ–ãƒªãƒ†ãƒ³ãŠã‚ˆã³åŒ—ã‚¢ã‚¤ãƒ«ãƒ©ãƒ³ãƒ‰é€£åˆç‹å›½",
                    "ã‚°ãƒ¬ãƒ¼ãƒˆãƒ–ãƒªãƒ†ãƒ³ãŠã‚ˆã³åŒ—ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰é€£åˆç‹å›½",
                    "ã‚°ãƒ¬ãƒ¼ãƒˆãƒ–ãƒªãƒ†ãƒ³ãŠã‚ˆã³å—ã‚¢ã‚¤ãƒ«ãƒ©ãƒ³ãƒ‰é€£åˆç‹å›½",
                    "ã‚°ãƒ¬ãƒ¼ãƒˆãƒ–ãƒªãƒ†ãƒ³ãŠã‚ˆã³å—ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰é€£åˆç‹",
                ],
                options_kana: [
                    "ãã‚Œãƒ¼ã¨ã¶ã‚Šã¦ã‚“ãŠã‚ˆã³ããŸã‚ã„ã‚‹ã‚‰ã‚“ã©ã‚Œã‚“ã”ã†ãŠã†ã“ã",
                    "ãã‚Œãƒ¼ã¨ã¶ã‚Šã¦ã‚“ãŠã‚ˆã³ããŸã™ã“ã£ã¨ã‚‰ã‚“ã©ã‚Œã‚“ã”ã†ãŠã†ã“ã",
                    "ãã‚Œãƒ¼ã¨ã¶ã‚Šã¦ã‚“ãŠã‚ˆã³ã¿ãªã¿ã‚ã„ã‚‹ã‚‰ã‚“ã©ã‚Œã‚“ã”ã†ãŠã†ã“ã",
                    "ãã‚Œãƒ¼ã¨ã¶ã‚Šã¦ã‚“ãŠã‚ˆã³ã¿ãªã¿ã™ã“ã£ã¨ã‚‰ã‚“ã©ã‚Œã‚“ã”ã†ãŠã†ã“ã",
                ],
            },
            {
                question: "Q. ãƒ•ãƒ©ãƒ³ã‚¹ã®ç”»å®¶ãƒ»ã‚´ãƒ¼ã‚®ãƒ£ãƒ³ã®çµµç”»ã¨ã„ãˆã°ï¼Ÿ",
                options: [
                    "æˆ‘ã€…ã¯ã©ã“ã‹ã‚‰æ¥ãŸã®ã‹ æˆ‘ã€…ã¯ä½•è€…ã‹ æˆ‘ã€…ã¯ã©ã“ã¸è¡Œãã®ã‹",
                    "æˆ‘ã€…ã¯ä½•è€…ã‹ æˆ‘ã€…ã¯ã©ã“ã‹ã‚‰æ¥ãŸã®ã‹ æˆ‘ã€…ã¯ã©ã“ã¸è¡Œãã®ã‹",
                    "æˆ‘ã€…ã¯ã©ã“ã‹ã‚‰æ¥ãŸã®ã‹ æˆ‘ã€…ã¯ã©ã“ã¸è¡Œãã®ã‹ æˆ‘ã€…ã¯ä½•è€…ã‹",
                    "æˆ‘ã€…ã¯ä½•è€…ã‹ æˆ‘ã€…ã¯ã©ã“ã¸è¡Œãã®ã‹ æˆ‘ã€…ã¯ã©ã“ã‹ã‚‰æ¥ãŸã®ã‹",
                ],
                options_kana: [
                    "ã‚ã‚Œã‚ã‚Œã¯ã©ã“ã‹ã‚‰ããŸã®ã‹ã‚ã‚Œã‚ã‚Œã¯ãªã«ã‚‚ã®ã‹ã‚ã‚Œã‚ã‚Œã¯ã©ã“ã¸ã„ãã®ã‹",
                    "ã‚ã‚Œã‚ã‚Œã¯ãªã«ã‚‚ã®ã‹ã‚ã‚Œã‚ã‚Œã¯ã©ã“ã‹ã‚‰ããŸã®ã‹ã‚ã‚Œã‚ã‚Œã¯ã©ã“ã¸ã„ãã®ã‹",
                    "ã‚ã‚Œã‚ã‚Œã¯ã©ã“ã‹ã‚‰ããŸã®ã‹ã‚ã‚Œã‚ã‚Œã¯ã©ã“ã¸ã„ãã®ã‹ã‚ã‚Œã‚ã‚Œã¯ãªã«ã‚‚ã®ã‹",
                    "ã‚ã‚Œã‚ã‚Œã¯ãªã«ã‚‚ã®ã‹ã‚ã‚Œã‚ã‚Œã¯ã©ã“ã¸ã„ãã®ã‹ã‚ã‚Œã‚ã‚Œã¯ã©ã“ã‹ã‚‰ããŸã®ã‹",
                ],
            },
            {
                question: "Q. ã€Œãƒ©ãƒ ã‚µãƒ¼ãƒ«æ¡ç´„ã€ã®æ­£å¼åç§°ã¯ï¼Ÿ",
                options: [
                    // "<ruby>ç‰¹<rt>ã¨ã</rt></ruby>ã«<ruby>æ°´é³¥<rt>ã¿ãšã©ã‚Š</rt></ruby>ã®<ruby>ç”Ÿæ¯åœ°<rt>ã›ã„ããã¡</rt></ruby>ã¨ã—ã¦<ruby>å›½éš›çš„<rt>ã“ãã•ã„ã¦ã</rt></ruby>ã«<ruby>é‡è¦<rt>ã˜ã‚…ã†ã‚ˆã†</rt></ruby>ãª<ruby>æ¹¿åœ°<rt>ã—ã£ã¡</rt></ruby>ã«<ruby>é–¢<rt>ã‹ã‚“</rt></ruby>ã™ã‚‹<ruby>æ¡ç´„<rt>ã˜ã‚‡ã†ã‚„ã</rt></ruby>",
                    "ç‰¹ã«æ°´é³¥ã®ç”Ÿæ¯åœ°ã¨ã—ã¦å›½éš›çš„ã«é‡è¦ãªæ¹¿åœ°ã«é–¢ã™ã‚‹æ¡ç´„",
                    "ç‰¹ã«æ¸¡ã‚Šé³¥ã®ç”Ÿæ¯åœ°ã¨ã—ã¦å›½éš›çš„ã«é‡è¦ãªæ¹¿åœ°ã«é–¢ã™ã‚‹æ¡ç´„",
                    "ç‰¹ã«æ°´é³¥ã®ç”Ÿæ¯åœ°ã¨ã—ã¦å›½éš›çš„ã«é‡è¦ãªæ¹¿åŸã«é–¢ã™ã‚‹æ¡ç´„",
                    "ç‰¹ã«æ¸¡ã‚Šé³¥ã®ç”Ÿæ¯åœ°ã¨ã—ã¦å›½éš›çš„ã«é‡è¦ãªæ¹¿åŸã«é–¢ã™ã‚‹æ¡ç´„",
                ],
                options_kana: [
                    "ã¨ãã«ã¿ãšã©ã‚Šã®ã›ã„ããã¡ã¨ã—ã¦ã“ãã•ã„ã¦ãã«ã˜ã‚…ã†ã‚ˆã†ãªã—ã£ã¡ã«ã‹ã‚“ã™ã‚‹ã˜ã‚‡ã†ã‚„ã",
                    "ã¨ãã«ã‚ãŸã‚Šã©ã‚Šã®ã›ã„ããã¡ã¨ã—ã¦ã“ãã•ã„ã¦ãã«ã˜ã‚…ã†ã‚ˆã†ãªã—ã£ã¡ã«ã‹ã‚“ã™ã‚‹ã˜ã‚‡ã†ã‚„ã",
                    "ã¨ãã«ã¿ãšã©ã‚Šã®ã›ã„ããã¡ã¨ã—ã¦ã“ãã•ã„ã¦ãã«ã˜ã‚…ã†ã‚ˆã†ãªã—ã¤ã’ã‚“ã«ã‹ã‚“ã™ã‚‹ã˜ã‚‡ã†ã‚„ã",
                    "ã¨ãã«ã‚ãŸã‚Šã©ã‚Šã®ã›ã„ããã¡ã¨ã—ã¦ã“ãã•ã„ã¦ãã«ã˜ã‚…ã†ã‚ˆã†ãªã—ã¤ã’ã‚“ã«ã‹ã‚“ã™ã‚‹ã˜ã‚‡ã†ã‚„ã",
                ],
            },
        ];

        let romajiMapping = {}, timeLeft = 60, timer, passCount = 2;
        let userInput = "", score = 0, correctAnswers = 0;
        let shuffledQuestions = [], currentQuestionIndex = 0;
        let isProcessing = false, excludedOptions = [];

        const kanaToRomajiBase = {
            "ãã‚ƒ": "kya", "ãã‚…": "kyu", "ãã‚‡": "kyo",
            "ã—ã‚ƒ": "sha", "ã—ã‚…": "shu", "ã—ã‚‡": "sho",
            "ã—ã‡": "she",
            "ã˜ã‡": "je",
            "ã¡ã‡": "che",
            "ã¦ãƒ": "thi",
            "ã§ãƒ": "di",
            "ã¤ã": "tsa",
            "ã¤ãƒ": "tsi",
            "ã¤ã‡": "tse",
            "ã¤ã‰": "tso",
            "ã¡ã‚ƒ": "cha", "ã¡ã‚…": "chu", "ã¡ã‚‡": "cho",
            "ã«ã‚ƒ": "nya", "ã«ã‚…": "nyu", "ã«ã‚‡": "nyo",
            "ã²ã‚ƒ": "hya", "ã²ã‚…": "hyu", "ã²ã‚‡": "hyo",
            "ã¿ã‚ƒ": "mya", "ã¿ã‚…": "myu", "ã¿ã‚‡": "myo",
            "ã‚Šã‚ƒ": "rya", "ã‚Šã‚…": "ryu", "ã‚Šã‚‡": "ryo",
            "ãã‚ƒ": "gya", "ãã‚…": "gyu", "ãã‚‡": "gyo",
            "ã˜ã‚ƒ": "ja", "ã˜ã‚…": "ju", "ã˜ã‚‡": "jo",
            "ã³ã‚ƒ": "bya", "ã³ã‚…": "byu", "ã³ã‚‡": "byo",
            "ã´ã‚ƒ": "pya", "ã´ã‚…": "pyu", "ã´ã‚‡": "pyo",
            "ã‚": "a", "ã„": "i", "ã†": "u", "ãˆ": "e", "ãŠ": "o",
            "ã‹": "ka", "ã": "ki", "ã": "ku", "ã‘": "ke", "ã“": "ko",
            "ã•": "sa", "ã—": "shi", "ã™": "su", "ã›": "se", "ã": "so",
            "ãŸ": "ta", "ã¡": "chi", "ã¤": "tsu", "ã¦": "te", "ã¨": "to",
            "ãª": "na", "ã«": "ni", "ã¬": "nu", "ã­": "ne", "ã®": "no",
            "ã¯": "ha", "ã²": "hi", "ãµ": "fu", "ã¸": "he", "ã»": "ho",
            "ã¾": "ma", "ã¿": "mi", "ã‚€": "mu", "ã‚": "me", "ã‚‚": "mo",
            "ã‚„": "ya", "ã‚†": "yu", "ã‚ˆ": "yo",
            "ã‚‰": "ra", "ã‚Š": "ri", "ã‚‹": "ru", "ã‚Œ": "re", "ã‚": "ro",
            "ã‚": "wa", "ã‚’": "wo", "ã‚“": "n",
            "ãŒ": "ga", "ã": "gi", "ã": "gu", "ã’": "ge", "ã”": "go",
            "ã–": "za", "ã˜": "ji", "ãš": "zu", "ãœ": "ze", "ã": "zo",
            "ã ": "da", "ã¢": "ji", "ã¥": "zu", "ã§": "de", "ã©": "do",
            "ã°": "ba", "ã³": "bi", "ã¶": "bu", "ã¹": "be", "ã¼": "bo",
            "ã±": "pa", "ã´": "pi", "ã·": "pu", "ãº": "pe", "ã½": "po",
            "ã£": "small-tsu",
            "ãƒ¼": "-",
        };

        /* ========== Game Flow ========== */
        function startGame() {
            restoreSettings();
            updateRomajiMapping();
            resetGameState();
            showStartupCountdown();
        }

        function resetGameState() {
            clearInterval(timer);
            shuffledQuestions = JSON.parse(JSON.stringify(questions));
            shuffleArray(shuffledQuestions);
            shuffledQuestions.forEach(q => {
                const pairs = q.options.map((opt, i) => ({ display: opt, kana: q.options_kana[i] }));
                shuffleArray(pairs);
                q.shuffledOptions = pairs;
            });
            currentQuestionIndex = 0;
            score = 0; userInput = ""; passCount = 2; timeLeft = 60; excludedOptions = []; isProcessing = false;
            document.getElementById("start-container").style.display = "none";
            document.getElementById("result-container").style.display = "none";
            document.getElementById("quiz-container").style.display = "block";
            updateScoreDisplay(); updatePassDisplay();
        }

        function showStartupCountdown() {
            const popup = document.getElementById("popup");
            popup.className = "popup popup-start";
            popup.textContent = "Ready...";
            popup.style.display = "block";
            document.getElementById("question").textContent = "";
            document.getElementById("options").innerHTML = "";
            setTimeout(() => {
                popup.textContent = "Start!";
                setTimeout(() => {
                    popup.style.display = "none";
                    startGameTimer();
                    loadQuestion();
                }, 1000);
            }, 1000);
        }

        function startGameTimer() {
            clearInterval(timer);
            decrementTimer();
            timer = setInterval(decrementTimer, 100);
        }

        function decrementTimer() {
            const timerBar = document.getElementById("timer-bar");
            const timerText = document.getElementById("timer-text");
            const safeTimeLeft = Math.max(0, timeLeft - 0.05);
            timerBar.style.width = (safeTimeLeft / 60) * 100 + "%";
            timerText.textContent = `æ®‹ã‚Šï¼š${timeLeft <= 10 ? timeLeft.toFixed(1) : Math.ceil(timeLeft)}s`;
            timerBar.style.backgroundColor = timeLeft <= 10 ? "red" : timeLeft <= 30 ? "orange" : "#4caf50";
            if (timeLeft <= 0) { clearInterval(timer); showResult(); }
            timeLeft = Math.max(0, timeLeft - 0.1);
        }

        /* ========== Core Logic ========== */
        function loadQuestion() {
            const q = shuffledQuestions[currentQuestionIndex];
            document.getElementById("question").textContent = q.question;
            const optionsEl = document.getElementById("options");
            optionsEl.innerHTML = "";

            q.shuffledOptions.forEach(({ display, kana }) => {
                const roman = convertKanaToRomaji(kana);
                const div = document.createElement("div");
                div.className = "option";
                if (excludedOptions.includes(roman)) div.classList.add("disabled-option");
                div.innerHTML = `${display} <span class='roman' data-roman='${roman}'>${roman}</span>`;
                optionsEl.appendChild(div);
            });
        }
        function checkFullWord() {
            const q = shuffledQuestions[currentQuestionIndex];
            const romajiOpts = q.options_kana.map(convertKanaToRomaji); // â†ã“ã“ã§ kana ã‚’ä½¿ç”¨
            const correct = convertKanaToRomaji(q.options_kana[0]); // æ­£è§£ã‚‚ kana ã‹ã‚‰ç”Ÿæˆ

            const matchIdx = romajiOpts.findIndex(r => r === userInput);

            if (matchIdx !== -1) {
                isProcessing = true;
                if (romajiOpts[matchIdx] === correct) {
                    correctAnswers++;

                    const kana = q.options_kana[matchIdx];
                    const kanaLength = kana.length;
                    const points = kanaLength * 10;
                    score += points;

                    updateScoreDisplay();
                    showPopup("Correct!", true);
                } else {
                    excludedOptions.push(romajiOpts[matchIdx]);
                    showPopup("Wrong!", false);
                }
            }
        }
        function convertKanaToRomaji(kana) {
            const smallTsuSetting = document.querySelector('input[name="small-tsu"]:checked').value;
            const nSettingInput = document.querySelector('input[name="n"]:checked');
            const nSetting = nSettingInput ? nSettingInput.value : "auto";

            let result = "", i = 0;

            while (i < kana.length) {
                // å°ã•ã„ã€Œã£ã€
                if (kana[i] === "ã£") {
                    let nextChunk = kana.slice(i + 1, i + 3);
                    if (!kanaToRomajiBase[nextChunk]) nextChunk = kana[i + 1];
                    let rawRomaji = kanaToRomajiBase[nextChunk] || "";
                    rawRomaji = convertRomajiSettings(rawRomaji);

                    if (rawRomaji) {
                        if (smallTsuSetting === "double") {
                            result += rawRomaji[0];
                        } else {
                            const tsuRomaji = romajiMapping["tsu"] || "tsu";
                            result += smallTsuSetting + tsuRomaji;
                        }
                    }
                    i++;
                    continue;
                }

                // ã€Œã‚“ã€
                let chunk = kana.slice(i, i + 2);
                if (!kanaToRomajiBase[chunk]) chunk = kana[i];

                if (chunk === "ã‚“") {
                    const nextKana = kana[i + 1] || "";
                    let nextRomaji = kanaToRomajiBase[nextKana] || "";
                    nextRomaji = convertRomajiSettings(nextRomaji);
                    const nextChar = nextRomaji[0] || "";

                    if (nSetting === "nn") {
                        result += "nn";
                    } else {
                        if (nextKana === "" || ["a", "i", "u", "e", "o", "y", "n"].includes(nextChar)) {
                            result += "nn";
                        } else {
                            result += "n";
                        }
                    }

                    i += chunk.length;
                    continue;  // â† ã“ã“é‡è¦ï¼ï¼ï¼
                }

                // é€šå¸¸ã®ä»®åå¤‰æ›
                let romaji = kanaToRomajiBase[chunk] || "";
                romaji = convertRomajiSettings(romaji);
                result += romaji;
                i += chunk.length;
            }

            return result;
        }
        function convertRomajiSettings(str) {
            for (const [key, val] of Object.entries(romajiMapping)) {
                const regex = new RegExp(key, "g");
                str = str.replace(regex, val);
            }
            return str;
        }

        /* ========== UI Updates ========== */
        function updatePassDisplay() {
            document.getElementById("key-guide").textContent =
                `Spaceï¼šãƒ‘ã‚¹ï¼ˆæ®‹ã‚Š${passCount}ï¼‰ã€€ã€€Backspaceï¼š1æ–‡å­—å‰Šé™¤ã€€ã€€Enterï¼šå…¨å‰Šé™¤`;
        }
        function updateScoreDisplay() {
            document.getElementById("score-display").textContent = `å¾—ç‚¹ï¼š${score}`;
        }
        function showPopup(msg, isCorrect, isPass = false, isStart = false) {
            clearInterval(timer);
            const popup = document.getElementById("popup");

            // ğŸ’¡ æ—¢å­˜ã‚¯ãƒ©ã‚¹å‰Šé™¤
            popup.className = "popup";

            // ğŸ’¡ çŠ¶æ…‹ã«å¿œã˜ãŸè‰²ã‚¯ãƒ©ã‚¹ã‚’ä»˜åŠ 
            if (isCorrect) {
                popup.classList.add("popup-correct");
            } else if (isPass) {
                popup.classList.add("popup-pass");
            } else if (isStart) {
                popup.classList.add("popup-start");
            } else {
                popup.classList.add("popup-wrong");
            }

            popup.textContent = msg;
            popup.style.display = "block";

            setTimeout(() => {
                popup.style.display = "none";
                userInput = "";
                isProcessing = false;
                if (timeLeft > 0) startGameTimer();

                if (isCorrect || isPass) {
                    currentQuestionIndex++;
                    if (currentQuestionIndex < shuffledQuestions.length) {
                        loadQuestion();
                    } else {
                        showResult();
                    }
                } else {
                    loadQuestion();
                }
            }, 1000);
        }
        function showInvalidInput() {
            const container = document.getElementById("quiz-container");
            container.classList.add("input-error");
            setTimeout(() => container.classList.remove("input-error"), 100);
        }

        function highlightMatching() {
            let hasMatch = false;

            document.querySelectorAll('.roman').forEach(span => {
                const text = span.dataset.roman;

                if (excludedOptions.includes(text)) {
                    span.innerHTML = text;
                } else if (text.startsWith(userInput)) {
                    span.innerHTML =
                        `<span class='highlight-typed'>${text.slice(0, userInput.length)}</span>${text.slice(userInput.length)}`;
                    hasMatch = true;
                } else {
                    span.innerHTML = text;
                }
            });

            if (!hasMatch && userInput.length > 0) {
                showInvalidInput();
            }
        }

        /* ========== Result Screen ========== */
        function showResult() {
            document.getElementById("quiz-container").style.display = "none";
            const result = document.getElementById("result-container");
            result.style.display = "block";
            document.getElementById("final-score").textContent = score;
            document.getElementById("share-x").href = buildXShareURL(score);
        }

        function goHome() {
            clearInterval(timer);
            document.getElementById("quiz-container").style.display = "none";
            document.getElementById("result-container").style.display = "none";
            document.getElementById("start-container").style.display = "block";
        }

        function buildXShareURL(score) {
            const text = `ã€é•·å¤§èªã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ  SesquiTypedalianã€ã§${score}ç‚¹ã‚’ç²å¾—ã—ã¾ã—ãŸï¼`;
            const hashtags = "ã‚¿ã‚¤ãƒ”ãƒ³ã‚°,ã‚²ãƒ¼ãƒ ,é•·å¤§èª";
            const url = location.href;
            const params = new URLSearchParams({ text: text + "\n", url, hashtags });
            return "https://twitter.com/intent/tweet?" + params.toString();
        }

        /* ========== Helpers ========== */
        // function shuffleArray(arr) { for (let i = arr.length - 1; i > 0; i--) [arr[i], arr[Math.floor(Math.random() * (i + 1))]] = [arr[Math.floor(Math.random() * (i + 1))], arr[i]]; }
        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
        }
        function updateRomajiMapping() {
            const keys = ["shi", "ji", "chi", "tsu", "fu", "sha", "shu", "sho", "cha", "chu", "cho", "thi"];
            romajiMapping = {};
            keys.forEach(key => {
                romajiMapping[key] = document.querySelector(`input[name="${key}"]:checked`).value;
            });
        }
        function saveSettings() {
            const settings = {};
            document.querySelectorAll('.settings-container input[type="radio"]:checked').forEach(input => {
                settings[input.name] = input.value;
            });
            localStorage.setItem("romajiSettings", JSON.stringify(settings));
        }

        function restoreSettings() {
            const saved = localStorage.getItem("romajiSettings");
            if (!saved) return;
            const settings = JSON.parse(saved);
            for (const name in settings) {
                const selector = `input[name="${name}"][value="${settings[name]}"]`;
                const radio = document.querySelector(selector);
                if (radio) radio.checked = true;
            }
        }

        // === Keyboard handling ===
        document.addEventListener("keydown", function (e) {
            if (document.getElementById("quiz-container").style.display !== "block") return; // ã‚²ãƒ¼ãƒ ä¸­ã®ã¿
            if (isProcessing) return;

            if (e.key === "Backspace") {
                e.preventDefault();
                userInput = userInput.slice(0, -1);
            } else if (e.key === "Enter") {
                e.preventDefault();
                userInput = "";
            } else if (e.key === " ") {
                e.preventDefault();
                if (passCount > 0) {
                    passCount--;
                    updatePassDisplay();
                    isProcessing = true;
                    showPopup("Pass!", false, true);
                }
                return;
            } else if (/^[a-zA-Z\-]$/.test(e.key)) {
                const nextInput = userInput + e.key.toLowerCase();

                // å…¥åŠ›ãŒã©ã‚Œã‹ã®é¸æŠè‚¢ã®å…ˆé ­ä¸€è‡´ã«ãªã‚‹ã‹ç¢ºèª
                const romanSpans = document.querySelectorAll('.roman');
                const hasMatch = Array.from(romanSpans).some(span =>
                    !excludedOptions.includes(span.dataset.roman) &&
                    span.dataset.roman.startsWith(nextInput)
                );

                if (hasMatch) {
                    userInput = nextInput;
                } else {
                    showInvalidInput(); // å…¥åŠ›ã¯ç„¡è¦–ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®ã¿
                }
            } else {
                return; // ä»–ã‚­ãƒ¼ã¯ç„¡è¦–
            }

            highlightMatching();
            checkFullWord();
        });

        window.onload = () => {
            restoreSettings();
            document.getElementById("start-container").style.display = "block";
            document.querySelectorAll('.settings-container input[type="radio"]').forEach(i => i.addEventListener('change', saveSettings));
        };
    </script>
</body>

</html>